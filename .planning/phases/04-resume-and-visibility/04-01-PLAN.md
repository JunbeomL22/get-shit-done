---
phase: 04-resume-and-visibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/workflows/yolo.md
  - /home/junbeom/.claude/get-shit-done/workflows/yolo.md
autonomous: true
requirements: [STATE-04]

must_haves:
  truths:
    - "Re-invoking /gsd:yolo after a failed run shows a YOLO RESUME banner with the failure reason and resume position"
    - "User is offered three options: Resume, Start fresh, or Abort"
    - "Choosing Resume clears the failed stanza, sets NEXT_PHASE to the roadmap analyze next_phase, and proceeds to Phase B"
    - "Choosing Start fresh clears the failed stanza and proceeds to Phase B (Phase B re-reads next_phase via A2)"
    - "The active:false + failed_phase stanza state is detected as a distinct branch from active:true stale state"
  artifacts:
    - path: "get-shit-done/workflows/yolo.md"
      provides: "A3 resume branch for active:false + failed_phase state"
      contains: "YOLO RESUME"
    - path: "/home/junbeom/.claude/get-shit-done/workflows/yolo.md"
      provides: "Installed copy with A3 resume branch (absolute paths)"
      contains: "YOLO RESUME"
  key_links:
    - from: "yolo.md A3 Branch 3"
      to: "roadmap analyze"
      via: "next_phase field for authoritative resume position"
      pattern: "roadmap analyze.*next_phase"
    - from: "yolo.md A3 Branch 3 Resume option"
      to: "yolo.md Phase B"
      via: "yolo-state clear then fall through with NEXT_PHASE set"
      pattern: "yolo-state clear"
---

<objective>
Add resume-after-failure logic to yolo.md A3 so re-invoking `/gsd:yolo` after a prior failed run detects the `active: false` + `failed_phase` stanza state, shows a YOLO RESUME banner with failure context, and offers Resume/Start fresh/Abort options.

Purpose: Satisfies STATE-04 — interrupted YOLO sessions resume from the correct phase position as determined by `roadmap analyze`, not from the original start phase.

Output: Updated yolo.md (source + installed) with three-branch A3 stanza detection.
</objective>

<execution_context>
@/home/junbeom/.claude/get-shit-done/workflows/execute-plan.md
@/home/junbeom/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-resume-and-visibility/04-RESEARCH.md

Key context from research:
- yolo-state fail writes: { active: false, start_phase: N, timestamp: "...", failed_phase: N, failure_reason: "..." }
- yolo-state read returns {} when no stanza exists
- roadmap analyze returns: { next_phase, completed_phases, phase_count, phases: [...] }
- yolo-state write atomically replaces the entire stanza (no merge) — explicit clear before Phase B is for clarity only
- Source copy uses ~/.claude paths; installed copy uses /home/junbeom/.claude paths
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend yolo.md A3 with three-branch stanza detection and resume logic</name>
  <files>
    get-shit-done/workflows/yolo.md
    /home/junbeom/.claude/get-shit-done/workflows/yolo.md
  </files>
  <action>
Modify yolo.md A3 section ("Stale State Check") to detect three mutually exclusive stanza states. The current A3 only handles `active: true`. Add extraction of `failed_phase` and `failure_reason`, then add a new Branch 3 for the resume case.

**A3 changes — extend the bash block to extract two more fields:**

After the existing `YOLO_TS` line, add:
```bash
YOLO_FAILED=$(echo "$YOLO_JSON" | jq -r '.failed_phase // empty')
YOLO_REASON=$(echo "$YOLO_JSON" | jq -r '.failure_reason // "unknown"')
```

**Keep existing Branch 2 (active:true) exactly as-is.** It remains the `If YOLO_ACTIVE is "true"` block with "Clear and start fresh" / "Abort" options.

**Add new Branch 3 AFTER the existing Branch 2.** The new branch fires when `YOLO_ACTIVE` is "false" AND `YOLO_FAILED` is non-empty. This is the resume-after-failure case.

Branch 3 logic:

1. Call `roadmap analyze` to get authoritative resume position:
```bash
ANALYZE=$(node ~/.claude/get-shit-done/bin/gsd-tools.cjs roadmap analyze 2>/dev/null)
RESUME_PHASE=$(echo "$ANALYZE" | jq -r '.next_phase // empty')
TOTAL=$(echo "$ANALYZE" | jq -r '.phase_count')
COMPLETED=$(echo "$ANALYZE" | jq -r '.completed_phases')
```

2. Display YOLO RESUME banner:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GSD ► YOLO RESUME
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Previous run stopped at phase ${YOLO_FAILED} (${YOLO_REASON}).
Completed phases: ${COMPLETED} of ${TOTAL}

Next incomplete phase: ${RESUME_PHASE}
```

3. AskUserQuestion: "Resume from phase ${RESUME_PHASE}?"

Options:
  a. "Resume" — run `yolo-state clear`, set `NEXT_PHASE = RESUME_PHASE`, calculate `PHASES_REMAINING = TOTAL - COMPLETED`, then proceed to Phase B
  b. "Start fresh" — run `yolo-state clear`, then proceed to Phase B (Phase B re-reads next_phase via the A2 variables which are already set from the A2 step above)
  c. "Abort" — stop workflow

**Also update the Constraints section at the bottom of yolo.md:**
- Remove the line `- Do NOT implement resume logic (Phase 4 scope)` since resume is now implemented.

**Apply changes to both copies:**
- Source: `get-shit-done/workflows/yolo.md` (uses `~/.claude/` paths)
- Installed: `/home/junbeom/.claude/get-shit-done/workflows/yolo.md` (uses `/home/junbeom/.claude/` paths)

**Important:** The "Resume" option must use `RESUME_PHASE` from `roadmap analyze` (not `YOLO_FAILED` from the stanza). SC-1 explicitly requires "as determined by roadmap analyze". These are usually the same value, but roadmap analyze is the single source of truth.

**Important:** The "Start fresh" option should use the A2 variables (`NEXT_PHASE`, `PHASES_REMAINING`) which were already computed at the top of the workflow and are still valid.
  </action>
  <verify>
1. Read both copies of yolo.md and confirm:
   - A3 now extracts `YOLO_FAILED` and `YOLO_REASON` from the stanza
   - Branch 2 (active:true) is unchanged
   - Branch 3 (active:false + failed_phase) shows YOLO RESUME banner, calls roadmap analyze, offers three options
   - "Resume" option sets NEXT_PHASE=RESUME_PHASE and falls through to Phase B
   - "Start fresh" option clears stanza and falls through to Phase B using A2 variables
   - Constraints section no longer says "Do NOT implement resume logic"
2. Verify source copy uses `~/.claude/` paths
3. Verify installed copy uses `/home/junbeom/.claude/` paths
  </verify>
  <done>
yolo.md A3 detects three stanza states: no stanza (skip), active:true (stale — existing behavior), active:false+failed_phase (resume — new behavior with YOLO RESUME banner and three-option prompt). The resume constraint note is removed. Both source and installed copies are updated.
  </done>
</task>

</tasks>

<verification>
- [ ] yolo.md A3 has three mutually exclusive branches: no stanza, active:true, active:false+failed_phase
- [ ] YOLO RESUME banner displays prior failure phase, reason, completed count, and resume position
- [ ] Resume option uses `roadmap analyze` next_phase (not stanza failed_phase) as resume position
- [ ] Resume option clears stanza before falling through to Phase B
- [ ] Start fresh option clears stanza and uses A2 variables (NEXT_PHASE from original positional check)
- [ ] Abort option stops workflow
- [ ] "Do NOT implement resume logic" constraint is removed
- [ ] Source and installed copies are in sync (path differences only)
</verification>

<success_criteria>
- Re-invoking /gsd:yolo after a failed run (active:false + failed_phase stanza) shows a YOLO RESUME banner with prior failure context and offers Resume/Start fresh/Abort options
- "Resume" uses roadmap analyze next_phase as the authoritative resume position
- Existing behavior for active:true stale runs is unchanged
- Existing behavior for no stanza (normal launch) is unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/04-resume-and-visibility/04-01-SUMMARY.md`
</output>
